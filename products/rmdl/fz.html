<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ›²å‰åˆ—å°¼å°”ï¼ˆTreprostinilï¼‰åˆ†å­æœºåˆ¶å›¾ï½œæœ€ç»ˆå®Œæ•´ç‰ˆ</title>
<style>
  :root{
    --bg:#f3f6fb;--ink:#0f172a;--muted:#475569;--panel:#ffffff;--sub:#f8fafc;--b:#e2e8f0;--accent:#6366f1;--accent2:#7c3aed;
  }
  *{box-sizing:border-box}
  body{margin:0;font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans SC","PingFang SC",sans-serif;background:radial-gradient(1200px 800px at 20% -10%,#eef2ff 0%,#f8fafc 40%,#ffffff 100%)}
  .wrap{max-width:1600px;margin:0 auto;padding:20px}
  .header{background:var(--panel);border:1px solid var(--b);border-radius:18px;padding:20px 24px;margin-bottom:16px;box-shadow:0 10px 30px rgba(2,6,23,.06)}
  .title{font-weight:800;font-size:26px;margin:0 0 4px;background:linear-gradient(120deg,var(--accent),var(--accent2));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
  .subtitle{color:var(--muted)}
  .controls{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .chip{border:1.5px solid var(--b);background:var(--sub);border-radius:10px;padding:8px 12px;cursor:pointer}

  /* ä¸¤æ  + åº•éƒ¨è¯æ®åŒºï¼ˆè¯æ®ç»Ÿä¸€ä¸‹ç§»ï¼‰ */
  .layout{display:grid;grid-template-columns:360px 1fr;gap:16px}
  .panel{background:var(--panel);border:1px solid var(--b);border-radius:16px;box-shadow:0 8px 24px rgba(2,6,23,.05);overflow:hidden}
  .panel>.hd{display:flex;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid var(--b);background:linear-gradient(180deg,#fafbff,#fff)}
  .panel>.bd{padding:14px 16px}

  /* å·¦ä¾§è·¯å¾„ï¼ˆå”¯ä¸€äº¤äº’æ§åˆ¶ï¼Œè‰²ç³»åŒæ­¥æœºåˆ¶å›¾ï¼‰ */
  .left .bd{display:grid;gap:10px;max-height:820px;overflow:auto}
  .card{padding:12px;border:1px solid var(--b);background:var(--sub);border-radius:12px;cursor:pointer;transition:transform .2s, box-shadow .2s}
  .card:hover{transform:translateX(4px);box-shadow:0 6px 14px rgba(2,6,23,.06)}
  .card h3{margin:0 0 6px;font-size:14px;display:flex;align-items:center;gap:8px}
  .swatch{width:16px;height:16px;border-radius:6px;border:1px solid var(--b);flex:0 0 16px}
  .mini{color:var(--muted);font-size:12px;margin:0}
  .card.active{outline:2px solid transparent;box-shadow:0 0 0 2px rgba(99,102,241,.45) inset}

  /* ä¸­é—´å¤§ç”»å¸ƒ */
  .svgbox{position:relative}
  .zoom{position:absolute;top:10px;right:10px;display:flex;gap:6px;z-index:2}
  .zbtn{width:38px;height:38px;border-radius:10px;border:1px solid var(--b);background:var(--panel);cursor:pointer;font-size:18px}
  #scale{transform-origin:0 0;transition:transform .25s ease}
  #stage{width:100%;height:860px} /* æ”¾å¤§ç”»å¸ƒé«˜åº¦ */
  .metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:12px;border-top:1px dashed var(--b);background:var(--sub)}
  .m{padding:10px;border:1px solid var(--b);border-radius:12px;background:#fff;text-align:center}
  .m b{font-size:18px}
  .m span{display:block;color:var(--muted);font-size:12px}

  /* åº•éƒ¨è¯æ®åŒºï¼ˆç»Ÿä¸€ä¸‹ç§»ï¼Œå¡«å……ä¸‹æ–¹ç©ºé—´ï¼‰ */
  .foot{grid-column:1 / 3;display:grid;grid-template-columns:2fr 1fr 1fr;gap:16px;margin-top:16px}
  .stack{padding:12px 14px}
  .stack h4{margin:4px 0 8px}
  .ref{display:flex;flex-wrap:wrap;gap:8px}
  .ref .chip{background:#fff}
  .endpoint{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  .e{padding:10px;border:1px solid var(--b);border-radius:12px;background:#fff}
  .scenes{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  .s{padding:10px;border:1px dashed var(--b);border-radius:12px;background:#fff}

  /* Tooltip */
  #tip{position:fixed;left:0;top:0;opacity:0;pointer-events:none;background:#0f172a;color:#fff;padding:6px 8px;border-radius:8px;font-size:12px;transform:translate(10px,-10px);transition:opacity .2s}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <h1 class="title">æ›²å‰åˆ—å°¼å°”ï¼ˆTreprostinilï¼‰åˆ†å­æœºåˆ¶å›¾ Â· æœ€ç»ˆç‰ˆ</h1>
    <p class="subtitle"><b>PGIâ‚‚ ç±»ä¼¼ç‰©</b> Â· IPå—ä½“ â†’ Gs â†’ AC â†’ cAMP â†’ PKA/EPAC Â· 7æ¡ä½œç”¨è·¯å¾„ï¼ˆèˆ’å¼ /è¶…æåŒ–/æŠ—è¡€å°æ¿/æŠ—å¢æ®–/æŠ—ç‚/æŠ—çº¤ç»´åŒ–/å†…çš®ä¿æŠ¤ï¼‰</p>
    <div class="controls">
      <button class="chip" id="reset">ğŸ”„ é‡ç½®</button>
      <button class="chip" id="export">ğŸ’¾ å¯¼å‡ºSVG</button>
      <button class="chip" id="animate">âœ¨ æ’­æ”¾åŠ¨ç”»</button>
    </div>
  </div>

  <div class="layout">
    <!-- å·¦æ ï¼šå”¯ä¸€äº¤äº’æ§åˆ¶ï¼ˆå°†æœºåˆ¶å›¾è‰²ç³»åŒæ­¥åˆ°æ­¤ï¼‰ -->
    <section class="panel left">
      <div class="hd">æœºåˆ¶è·¯å¾„ï¼ˆç‚¹å‡»é«˜äº®é“¾è·¯ï¼‰</div>
      <div class="bd" id="cards"></div>
    </section>

    <!-- ä¸­æ ï¼šå¤§ç”»å¸ƒä¸æŒ‡æ ‡å¸¦ï¼ˆæœºåˆ¶å›¾å†…éƒ¨ä¸å†ç‚¹é€‰ï¼Œä»…æ‚¬æµ®æç¤ºï¼‰ -->
    <section class="panel middle">
      <div class="hd">äº¤äº’æœºåˆ¶å›¾ï¼ˆæ”¾å¤§ï¼‰</div>
      <div class="svgbox">
        <div class="zoom"><button class="zbtn" id="zin">+</button><button class="zbtn" id="zout">âˆ’</button></div>
        <div id="scale">
          <svg id="stage" viewBox="0 0 1400 860" xmlns="http://www.w3.org/2000/svg"></svg>
        </div>
      </div>
      <div class="metrics">
        <div class="m"><b>cAMPâ†‘</b><span>ä¿¡å·æ ¸å¿ƒæ”¾å¤§</span></div>
        <div class="m"><b>PVRâ†“/mPAPâ†“</b><span>è¡€æµåŠ¨åŠ›å­¦</span></div>
        <div class="m"><b>PLTèšé›†â†“</b><span>å¾®å¾ªç¯æ”¹å–„</span></div>
        <div class="m"><b>é‡æ„â†“</b><span>ç»“æ„é€†è½¬</span></div>
      </div>
    </section>

    <!-- åº•éƒ¨è¯æ®æ•´ä½“ä¸‹ç§»ï¼ˆé¿å…ä¸Šæ–¹æ‹¥æŒ¤/ç©ºæ—·ä¸å‡è¡¡ï¼‰ -->
    <section class="panel foot">
      <div class="stack">
        <h4>ğŸ“š è¯æ®è¦ç‚¹ï¼ˆç¤ºä¾‹ï¼Œå¯æ›¿æ¢ä¸ºçœŸå®æ–‡çŒ®ï¼‰</h4>
        <ul id="evidenceList" style="margin:0;padding-left:18px;color:var(--muted)"></ul>
      </div>
      <div class="stack">
        <h4>ğŸ¯ å…³é”®ä¸´åºŠç»ˆç‚¹</h4>
        <div class="endpoint">
          <div class="e"><b>6MWDâ†‘</b><div class="mini">è¿åŠ¨è€é‡æå‡</div></div>
          <div class="e"><b>NTâ€‘proBNPâ†“</b><div class="mini">å¿ƒè¡°è´Ÿè·å‡è½»</div></div>
          <div class="e"><b>WHOâ€‘FCæ”¹å–„</b><div class="mini">åŠŸèƒ½çº§åˆ«ä¸Šè°ƒ</div></div>
          <div class="e"><b>ä½é™¢ç‡â†“</b><div class="mini">äº‹ä»¶é£é™©é™ä½</div></div>
        </div>
      </div>
      <div class="stack">
        <h4>ğŸ§­ ä¸´åºŠåœºæ™¯</h4>
        <div class="scenes">
          <div class="s">è¡€å°æ¿é«˜ååº”æ€§ â†’ å¼ºåŒ–æŠ—èšé›†é“¾è·¯</div>
          <div class="s">é‡æ„æ˜¾è‘—/å³å¿ƒè¡° â†’ å¼ºåŒ–æŠ—å¢æ®–/æŠ—çº¤ç»´åŒ–</div>
          <div class="s">å†…çš®åŠŸèƒ½å·®/ETâ€‘1é«˜ â†’ å†…çš®ä¿æŠ¤/ETâ€‘1ä¸‹è°ƒ</div>
          <div class="s">è¿åŠ¨è€é‡å·® â†’ è¶…æåŒ–+èˆ’å¼ å¹¶ä¸¾</div>
        </div>
      </div>
    </section>
  </div>
</div>
<div id="tip"></div>

<script>
(()=>{
  // è·¯å¾„è‰²ç³»ï¼ˆä¸æœºåˆ¶å›¾å®Œå…¨ä¸€è‡´ï¼‰
  const flows=[
    {id:"vasodilation",label:"è¡€ç®¡èˆ’å¼ ",grad:["#60a5fa","#3b82f6"]},
    {id:"hyperpolarization",label:"è¶…æåŒ–",grad:["#a78bfa","#8b5cf6"]},
    {id:"antiplatelet",label:"æŠ—è¡€å°æ¿",grad:["#34d399","#10b981"]},
    {id:"antiproliferation",label:"æŠ—å¢æ®–",grad:["#22d3ee","#06b6d4"]},
    {id:"antiinflammation",label:"æŠ—ç‚",grad:["#fbbf24","#f59e0b"]},
    {id:"antifibrosis",label:"æŠ—çº¤ç»´åŒ–",grad:["#f9a8d4","#ec4899"]},
    {id:"endoprotection",label:"å†…çš®ä¿æŠ¤",grad:["#4ade80","#22c55e"]}
  ];

  // èŠ‚ç‚¹å¸ƒå±€ï¼ˆæ›´å¤§ç”»å¸ƒï¼Œç¡®ä¿èŠ‚ç‚¹æ¸…æ™°å¯è§ï¼‰
  const nodes=[
    {id:"tre",x:60,y:40,t:"æ›²å‰åˆ—å°¼å°”",s:"Treprostinil",tip:"PGIâ‚‚ç±»ä¼¼ç‰©ï¼Œæ¿€æ´»IPå—ä½“"},
    {id:"ip",x:280,y:40,t:"IPå—ä½“",s:"Gsâ€‘GPCR",tip:"Gè›‹ç™½å¶è”å—ä½“"},
    {id:"ac",x:500,y:40,t:"ACâ†‘",s:"è…ºè‹·é…¸ç¯åŒ–é…¶",tip:"ATPâ†’cAMP"},
    {id:"camp",x:720,y:40,t:"cAMPâ†‘",s:"ç¬¬äºŒä¿¡ä½¿",tip:"æ¿€æ´»PKA/EPAC"},

    {id:"pka",x:720,y:150,t:"PKA",s:"è›‹ç™½æ¿€é…¶A",tip:"ç£·é…¸åŒ–è°ƒæ§"},
    {id:"mlck",x:720,y:250,t:"MLCKâ†“",s:"è½»é“¾æ¿€é…¶",tip:"æ”¶ç¼©é™ä½"},
    {id:"smc",x:720,y:350,t:"å¹³æ»‘è‚Œèˆ’å¼ ",s:"Vasorelax",tip:"è¡€ç®¡æ‰©å¼ "},
    {id:"hemo",x:720,y:450,t:"PVRâ†“ mPAPâ†“",s:"è¡€æµåŠ¨åŠ›å­¦",tip:"é˜»åŠ›/å‹åŠ›ä¸‹é™"},

    {id:"kca",x:960,y:150,t:"KCaé€šé“",s:"Kâºå¤–æµ",tip:"è†œè¶…æåŒ–"},
    {id:"hyper",x:960,y:250,t:"è¶…æåŒ–",s:"Hyper",tip:"ååŒèˆ’å¼ "},

    {id:"plt",x:500,y:250,t:"è¡€å°æ¿cAMPâ†‘",s:"èšé›†â†“",tip:"å¾®å¾ªç¯æ”¹å–„"},

    {id:"epac",x:960,y:40,t:"EPAC",s:"RAP1â€‘GEF",tip:"éª¨æ¶/é»é™„"},
    {id:"mapk",x:960,y:350,t:"MAPK/ERKâ†“",s:"å¢æ®–ä¿¡å·",tip:"æŠ‘åˆ¶å¢æ®–"},
    {id:"rhoa",x:1200,y:350,t:"RhoA/ROCKâ†“",s:"éª¨æ¶",tip:"æŠ‘åˆ¶è¿ç§»"},
    {id:"prolif",x:1080,y:450,t:"PASMCå¢æ®–â†“",s:"Antiâ€‘prolif",tip:"å¹³æ»‘è‚Œç»†èƒ"},
    {id:"remodel",x:1080,y:550,t:"è¡€ç®¡é‡æ„â†“",s:"Remodelâ†“",tip:"ä¸­è†œè‚¥åšé€†è½¬"},

    {id:"nfkb",x:500,y:350,t:"NFâ€‘ÎºBâ†“",s:"ç‚ç—‡å› å­",tip:"æ ¸è½¬ä½æŠ‘åˆ¶"},
    {id:"cyto",x:500,y:450,t:"ILâ€‘6/TNFâ€‘Î±â†“",s:"ç»†èƒå› å­",tip:"ä»‹è´¨å‡å°‘"},
    {id:"inflam",x:500,y:550,t:"ç‚ç—‡ååº”â†“",s:"Antiâ€‘inflam",tip:"ç‚ç—‡ç¼“è§£"},

    {id:"enos",x:280,y:150,t:"eNOS/NOâ†‘",s:"å†…çš®NO",tip:"èˆ’å¼ /æŠ—ç‚/æŠ—èšé›†"},
    {id:"et1",x:280,y:250,t:"ETâ€‘1â†“",s:"å†…çš®ç´ â€‘1",tip:"ç¼©è¡€ç®¡å› å­é™ä½"},
    {id:"endo",x:280,y:350,t:"å†…çš®åŠŸèƒ½â†‘",s:"Endothelial",tip:"ç¨³æ€æ¢å¤"},

    {id:"tgf",x:720,y:550,t:"TGFâ€‘Î²/Smadâ†“",s:"çº¤ç»´åŒ–",tip:"æˆçº¤ç»´åˆ†åŒ–æŠ‘åˆ¶"},
    {id:"fibro",x:720,y:650,t:"æˆçº¤ç»´ç»†èƒâ†“",s:"Myofibro",tip:"Î±â€‘SMAä¸‹é™"},
    {id:"coll",x:720,y:750,t:"èƒ¶åŸæ²‰ç§¯â†“",s:"Collagenâ†“",tip:"é¡ºåº”æ€§æ”¹å–„"}
  ];

  const edges=[
    {from:"tre",to:"ip",flows:flows.map(f=>f.id)},{from:"ip",to:"ac",flows:flows.map(f=>f.id)},{from:"ac",to:"camp",flows:flows.map(f=>f.id)},
    {from:"camp",to:"pka",flows:["vasodilation","antiproliferation","antiinflammation","antifibrosis","endoprotection"]},
    {from:"pka",to:"mlck",flows:["vasodilation"]},{from:"mlck",to:"smc",flows:["vasodilation"]},{from:"smc",to:"hemo",flows:["vasodilation"]},
    {from:"camp",to:"kca",flows:["hyperpolarization"]},{from:"kca",to:"hyper",flows:["hyperpolarization"]},
    {from:"camp",to:"plt",flows:["antiplatelet"]},
    {from:"camp",to:"epac",flows:["antiproliferation","antifibrosis"]},{from:"pka",to:"mapk",flows:["antiproliferation"]},{from:"epac",to:"rhoa",flows:["antiproliferation"]},{from:"mapk",to:"prolif",flows:["antiproliferation"]},{from:"rhoa",to:"prolif",flows:["antiproliferation"]},{from:"prolif",to:"remodel",flows:["antiproliferation","antifibrosis"]},
    {from:"pka",to:"nfkb",flows:["antiinflammation"]},{from:"nfkb",to:"cyto",flows:["antiinflammation"]},{from:"cyto",to:"inflam",flows:["antiinflammation"]},
    {from:"pka",to:"enos",flows:["endoprotection"]},{from:"camp",to:"et1",flows:["endoprotection"]},{from:"enos",to:"endo",flows:["endoprotection"]},{from:"et1",to:"endo",flows:["endoprotection"]},{from:"endo",to:"hemo",flows:["endoprotection"]},
    {from:"pka",to:"tgf",flows:["antifibrosis"]},{from:"epac",to:"tgf",flows:["antifibrosis"]},{from:"tgf",to:"fibro",flows:["antifibrosis"]},{from:"fibro",to:"coll",flows:["antifibrosis"]},{from:"coll",to:"remodel",flows:["antifibrosis"]}
  ];

  const stage=document.getElementById('stage');
  const scale=document.getElementById('scale');
  const tip=document.getElementById('tip');
  const cards=document.getElementById('cards');
  const zin=document.getElementById('zin');
  const zout=document.getElementById('zout');
  const exportBtn=document.getElementById('export');
  const animateBtn=document.getElementById('animate');
  const resetBtn=document.getElementById('reset');

  let active='all', scaleVal=1;

  // åˆ›å»ºè‰²å—å¡ç‰‡ï¼ˆå”¯ä¸€äº¤äº’æ§åˆ¶ï¼‰
  flows.forEach(f=>{
    const c=document.createElement('div');
    c.className='card';
    c.dataset.path=f.id;
    c.innerHTML=`<h3><span class=\"swatch\" style=\"background:linear-gradient(135deg,${f.grad[0]},${f.grad[1]})\"></span>${f.label}</h3><p class=\"mini\">ç‚¹å‡»é«˜äº®è¯¥é“¾è·¯</p>`;
    cards.appendChild(c);
  });
  // æ·»åŠ â€œå…¨éƒ¨â€
  const allCard=document.createElement('div');
  allCard.className='card active';
  allCard.dataset.path='all';
  allCard.innerHTML=`<h3><span class=\"swatch\" style=\"background:linear-gradient(135deg,#6366f1,#7c3aed)\"></span>å…¨éƒ¨è·¯å¾„</h3><p class=\"mini\">æ˜¾ç¤ºæ‰€æœ‰é“¾è·¯</p>`;
  cards.prepend(allCard);

  function defs(){
    let d=stage.querySelector('defs');if(!d){d=document.createElementNS('http://www.w3.org/2000/svg','defs');stage.appendChild(d)}
    d.innerHTML='';
    flows.forEach(f=>{
      const lg=document.createElementNS('http://www.w3.org/2000/svg','linearGradient');lg.id='g-'+f.id;lg.innerHTML=`<stop offset=\"0%\" stop-color=\"${f.grad[0]}\"/><stop offset=\"100%\" stop-color=\"${f.grad[1]}\"/>`;d.appendChild(lg);
      const m=document.createElementNS('http://www.w3.org/2000/svg','marker');m.id='m-'+f.id;m.setAttribute('viewBox','0 0 10 10');m.setAttribute('refX','10');m.setAttribute('refY','5');m.setAttribute('markerWidth','6');m.setAttribute('markerHeight','6');m.setAttribute('orient','auto');m.innerHTML=`<path d=\"M0 0 L10 5 L0 10 Z\" fill=\"${f.grad[1]}\"/>`;d.appendChild(m);
    });
    const m=document.createElementNS('http://www.w3.org/2000/svg','marker');m.id='m-all';m.setAttribute('viewBox','0 0 10 10');m.setAttribute('refX','10');m.setAttribute('refY','5');m.setAttribute('markerWidth','6');m.setAttribute('markerHeight','6');m.setAttribute('orient','auto');m.innerHTML='<path d="M0 0 L10 5 L0 10 Z" fill="#94a3b8"/>';d.appendChild(m);

    // é˜´å½±ä¸å‘å…‰
    const filter=document.createElementNS('http://www.w3.org/2000/svg','filter');filter.id='shadow';filter.innerHTML='<feGaussianBlur in="SourceAlpha" stdDeviation="3"/><feOffset dx="0" dy="2" result="ob"/><feFlood flood-color="#000" flood-opacity="0.15"/><feComposite in2="ob" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>';d.appendChild(filter);
    const glow=document.createElementNS('http://www.w3.org/2000/svg','filter');glow.id='glow';glow.innerHTML='<feGaussianBlur stdDeviation="4" result="cb"/><feMerge><feMergeNode in="cb"/><feMergeNode in="SourceGraphic"/></feMerge>';d.appendChild(glow);
  }

  function grid(){
    const g=document.createElementNS('http://www.w3.org/2000/svg','g');g.setAttribute('opacity','.05');
    for(let y=0;y<=860;y+=20){const l=document.createElementNS('http://www.w3.org/2000/svg','line');l.setAttribute('x1','0');l.setAttribute('y1',y);l.setAttribute('x2','1400');l.setAttribute('y2',y);l.setAttribute('stroke','#94a3b8');g.appendChild(l)}
    for(let x=0;x<=1400;x+=20){const l=document.createElementNS('http://www.w3.org/2000/svg','line');l.setAttribute('x1',x);l.setAttribute('y1','0');l.setAttribute('x2',x);l.setAttribute('y2','860');l.setAttribute('stroke','#94a3b8');g.appendChild(l)}
    return g;
  }

  const pos=Object.fromEntries(nodes.map(n=>[n.id,{x:n.x,y:n.y}]));
  function path(from,to){const a=pos[from],b=pos[to];const dx=b.x-(a.x+160),dy=b.y-a.y;const c1x=a.x+160+dx*.3,c1y=a.y+dy*.1,c2x=b.x-dx*.3,c2y=b.y-dy*.1;return `M ${a.x+160} ${a.y+30} C ${c1x} ${c1y}, ${c2x} ${c2y}, ${b.x} ${b.y+30}`}

  function draw(anim=false){
    stage.innerHTML='';defs();stage.appendChild(grid());
    const ge=document.createElementNS('http://www.w3.org/2000/svg','g');
    const gn=document.createElementNS('http://www.w3.org/2000/svg','g');

    edges.forEach((e,i)=>{
      const p=document.createElementNS('http://www.w3.org/2000/svg','path');
      p.setAttribute('d',path(e.from,e.to));
      p.setAttribute('fill','none');
      const act=(active==='all')||e.flows.includes(active);
      if(active==='all'){p.setAttribute('stroke','#94a3b8');p.setAttribute('opacity','.5');p.setAttribute('stroke-width','2');p.setAttribute('marker-end','url(#m-all)')}
      else if(act){p.setAttribute('stroke',`url(#g-${active})`);p.setAttribute('stroke-width','3');p.setAttribute('marker-end',`url(#m-${active})`)}
      else{p.setAttribute('stroke','#e5e7eb');p.setAttribute('opacity','.2');p.setAttribute('stroke-width','1.5')}
      if(anim&&act){p.style.strokeDasharray='1000';p.style.strokeDashoffset='1000';p.style.animation=`dash 1.2s ease ${i*0.06}s forwards`}
      ge.appendChild(p);
    });

    nodes.forEach((n,i)=>{
      const g=document.createElementNS('http://www.w3.org/2000/svg','g');g.setAttribute('transform',`translate(${n.x},${n.y})`);g.style.cursor='default';
      const r=document.createElementNS('http://www.w3.org/2000/svg','rect');r.setAttribute('width','160');r.setAttribute('height','60');r.setAttribute('rx','12');r.setAttribute('fill','#fff');r.setAttribute('stroke','#e2e8f0');r.setAttribute('stroke-width','2');
      // é«˜äº®å½“å‰é€šè·¯æ¶‰åŠèŠ‚ç‚¹
      const isActive = active==='all' || edges.some(e => (e.from===n.id || e.to===n.id) && e.flows.includes(active));
      if(isActive && active!=='all'){r.setAttribute('stroke',flows.find(f=>f.id===active).grad[1]);r.setAttribute('stroke-width','3');r.setAttribute('filter','url(#glow)')}

      const t1=document.createElementNS('http://www.w3.org/2000/svg','text');t1.setAttribute('x','80');t1.setAttribute('y','24');t1.setAttribute('text-anchor','middle');t1.setAttribute('font-size','13');t1.setAttribute('font-weight','700');t1.setAttribute('fill','#0f172a');t1.textContent=n.t;
      const t2=document.createElementNS('http://www.w3.org/2000/svg','text');t2.setAttribute('x','80');t2.setAttribute('y','42');t2.setAttribute('text-anchor','middle');t2.setAttribute('font-size','11');t2.setAttribute('fill','#64748b');t2.textContent=n.s;

      // æ‚¬æµ®æç¤º
      g.addEventListener('mouseenter',ev=>{tip.textContent=n.tip||`${n.t} â€” ${n.s}`;tip.style.opacity=.95;tip.style.left=ev.pageX+10+'px';tip.style.top=ev.pageY-28+'px'});
      g.addEventListener('mousemove',ev=>{tip.style.left=ev.pageX+10+'px';tip.style.top=ev.pageY-28+'px'});
      g.addEventListener('mouseleave',()=>{tip.style.opacity=0});

      g.appendChild(r);g.appendChild(t1);g.appendChild(t2);if(anim){g.style.opacity=0;g.style.animation=`fade .4s ease ${i*0.04}s forwards`}
      gn.appendChild(g);
    });

    stage.appendChild(ge);stage.appendChild(gn);

    // é¡¶éƒ¨æ ‡ç­¾
    const label=document.createElementNS('http://www.w3.org/2000/svg','g');
    label.innerHTML=`<rect x="50" y="120" width="300" height="30" rx="15" fill="#fff" stroke="#e2e8f0" opacity="0.95"/><text x="200" y="140" text-anchor="middle" font-size="12" fill="#475569">æ ¸å¿ƒé“¾è·¯ï¼šIPâ†’Gsâ†’ACâ†’cAMPâ†’PKA/EPAC</text>`;
    stage.appendChild(label);
  }

  // åŠ¨ç”»æ ·å¼
  const style=document.createElement('style');style.textContent=`@keyframes dash{to{stroke-dashoffset:0}}@keyframes fade{to{opacity:1}}`;document.head.appendChild(style);
  draw();

  // å·¦ä¾§å”¯ä¸€äº¤äº’ï¼šç­›é€‰é“¾è·¯
  cards.addEventListener('click',e=>{
    const t=e.target.closest('.card');if(!t)return;
    active=t.dataset.path;
    document.querySelectorAll('.card').forEach(el=>el.classList.toggle('active',el===t));
    draw();
  });

  // ç¼©æ”¾ / é‡ç½® / åŠ¨ç”» / å¯¼å‡º
  zin.onclick=()=>{scaleVal=Math.min(scaleVal+0.1,2.2);scale.style.transform=`scale(${scaleVal})`};
  zout.onclick=()=>{scaleVal=Math.max(scaleVal-0.1,.6);scale.style.transform=`scale(${scaleVal})`};
  resetBtn.onclick=()=>{active='all';scaleVal=1;scale.style.transform='scale(1)';document.querySelectorAll('.card').forEach(el=>el.classList.remove('active'));document.querySelector('[data-path="all"]').classList.add('active');draw()};
  animateBtn.onclick=()=>draw(true);
  exportBtn.onclick=()=>{const ser=new XMLSerializer();const src=ser.serializeToString(stage);const blob=new Blob([src],{type:'image/svg+xml;charset=utf-8'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='treprostinil_mechanism.svg';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url)};

  // è¯æ®è¦ç‚¹ï¼ˆç¤ºä¾‹ï¼Œå ä½ï¼‰
  const evidence=[
    'IP â†’ cAMP â†’ PKA/EPAC åŒé€šè·¯è¯æ®',
    'æŠ—å¢æ®–ï¼šMAPK/ERK ä¸ RhoA/ROCK ä¸‹è°ƒ',
    'æŠ—ç‚ï¼šNFâ€‘ÎºBæ ¸è½¬ä½æŠ‘åˆ¶ï¼Œç‚ç—‡å› å­ä¸‹é™',
    'å†…çš®ä¿æŠ¤ï¼šeNOS/NOâ†‘ ä¸ ETâ€‘1â†“ ååŒ',
    'æŠ—çº¤ç»´åŒ–ï¼šTGFâ€‘Î²/Smad æŠ‘åˆ¶ï¼Œèƒ¶åŸæ²‰ç§¯ä¸‹é™'
  ];
  const evidenceList=document.getElementById('evidenceList');
  evidence.forEach(t=>{const li=document.createElement('li');li.textContent=t;evidenceList.appendChild(li)});
})();
</script>
</body>
</html>
